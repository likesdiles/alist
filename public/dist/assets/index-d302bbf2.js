import{cg as ge,V,ch as W,ci as x,az as J,a7 as v,x as e,ao as M,an as S,a4 as y,d as Z,cc as k,cj as I,r as Q,aO as X,bq as $,c2 as pe,ck as he,cl as fe,cm as me,cn as we,b as be,A as Ce,B as w,co as $e,b9 as R,q as _e,ai as ve,bX as A,aL as ye,am as xe,bW as Se,S as b,L as O,bb as q,av as ke,Q as D,bB as Ie,bC as Le,cp as Ee,aS as Ge,n as C,br as Pe,cq as H}from"./index-2b442b7d.js";import{a as Me}from"./useTitle-3eac75a0.js";import{s as Re,g as Ae,a as Oe}from"./webauthn-json.browser-ponyfill-f2f06d6e.js";const ze="https://github.com/alist-org/alist";function Be(r){return ge(`${r}-${ze}`)}const Te=J('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="896" width="967.8852157128662"><defs><path id="path-2" opacity="1" fill-rule="evenodd" d="M896,448 C1142.6325445712241,465.5747656464056 695.2579309733121,896 448,896 C200.74206902668806,896 5.684341886080802e-14,695.2579309733121 0,448.0000000000001 C0,200.74206902668806 200.74206902668791,5.684341886080802e-14 447.99999999999994,0 C695.2579309733121,0 475,418 896,448Z"></path><linearGradient id="linearGradient-3" x1="0.5" y1="0" x2="0.5" y2="1"><stop offset="0" stop-opacity="1"></stop><stop offset="1" stop-opacity="1"></stop></linearGradient></defs><g opacity="1"><use xlink:href="#path-2" fill="url(#linearGradient-3)" fill-opacity="1"></use></g></svg>'),Ue=r=>{const o=V({startColor:"#28aff0",endColor:"#120fc4"},r);return(()=>{const c=Te.cloneNode(!0),h=c.firstChild,s=h.firstChild,u=s.nextSibling,a=u.firstChild,d=a.nextSibling;return W(t=>{const l=o.startColor,g=o.endColor;return l!==t._v$&&x(a,"stop-color",t._v$=l),g!==t._v$2&&x(d,"stop-color",t._v$2=g),t},{_v$:void 0,_v$2:void 0}),c})()},Fe=J('<svg height="1337" width="1337"><defs><path id="path-1" opacity="1" fill-rule="evenodd" d="M1337,668.5 C1337,1037.455193874239 1037.455193874239,1337 668.5,1337 C523.6725684305388,1337 337,1236 370.50000000000006,1094 C434.03835568300906,824.6732385973953 6.906089672974592e-14,892.6277623047779 0,668.5000000000001 C0,299.5448061257611 299.5448061257609,1.1368683772161603e-13 668.4999999999999,0 C1037.455193874239,0 1337,299.544806125761 1337,668.5Z"></path><linearGradient id="linearGradient-2" x1="0.79" y1="0.62" x2="0.21" y2="0.86"><stop offset="0" stop-opacity="1"></stop><stop offset="1" stop-opacity="1"></stop></linearGradient></defs><g opacity="1"><use xlink:href="#path-1" fill="url(#linearGradient-2)" fill-opacity="1"></use></g></svg>'),Ne=r=>{const o=V({startColor:"#28aff0",endColor:"#120fc4"},r);return(()=>{const c=Fe.cloneNode(!0),h=c.firstChild,s=h.firstChild,u=s.nextSibling,a=u.firstChild,d=a.nextSibling;return W(t=>{const l=o.startColor,g=o.endColor;return l!==t._v$&&x(a,"stop-color",t._v$=l),g!==t._v$2&&x(d,"stop-color",t._v$2=g),t},{_v$:void 0,_v$2:void 0}),c})()},Ke=()=>{const r=v("#a9c6ff","#062b74");return e(M,{get bgColor(){return r()},pos:"fixed",top:"0",left:"0",overflow:"hidden",zIndex:"-1",w:"100vw",h:"100vh",get children(){return[e(M,{pos:"absolute",right:{"@initial":"-100px","@sm":"-300px"},top:{"@initial":"-1170px","@sm":"-900px"},get children(){return e(Ne,{})}}),e(M,{pos:"absolute",left:{"@initial":"-100px","@sm":"-200px"},bottom:{"@initial":"-760px","@sm":"-400px"},get children(){return e(Ue,{})}})]}})},je=()=>{const r=S("sso_login_enabled"),o=y("sso_login_platform"),c=S("sso_compatibility_mode"),{searchParams:h,to:s}=Z(),u=h.token;u!=null&&u!=""&&(k(u),s(decodeURIComponent(h.redirect||I||"/"),!0));function a(d){const t=d.data;t.token&&(k(t.token),s(decodeURIComponent(h.redirect||I||"/"),!0))}if(window.addEventListener("message",a),Q(()=>{window.removeEventListener("message",a)}),r){const d=()=>{const l=$.getUri()+"/auth/sso?method=sso_get_token";if(c){window.location.href=l;return}window.open(l,"authPopup","width=500,height=600")};let t;switch(o){case"Github":t=we;break;case"Microsoft":t=me;break;case"Google":t=fe;break;case"Dingtalk":t=he;break;default:t=pe}return e(X,{cursor:"pointer",boxSize:"$8",as:t,p:"$0_5",onclick:d})}},Ve=()=>{const r=y("logo").split(`
`);v(r[0],r.pop());const o=be(),c=Ce(()=>`${y("site_title")}`);Me(c);const h=v("white","$neutral1"),[s,u]=w(localStorage.getItem("username")||""),[a,d]=w(localStorage.getItem("password")||""),[t,l]=w(""),[g,Y]=w(!1),[_,ee]=$e("remember-pwd","false"),[L,z]=w(!1),[te,ne]=R(async()=>L()?$.post("/auth/login/ldap",{username:s(),password:a(),otp_code:t()}):$.post("/auth/login/hash",{username:s(),password:Be(a()),otp_code:t()})),[,oe]=R((n,i,m,P)=>$.post("/authn/webauthn_finish_login?username="+m,JSON.stringify(i),{headers:{session:n},signal:P})),[,re]=R((n,i)=>$.get("/authn/webauthn_begin_login?username="+n,{signal:i})),{searchParams:B,to:T}=Z(),se=async()=>PublicKeyCredential&&"isConditionalMediationAvailable"in PublicKeyCredential?await PublicKeyCredential.isConditionalMediationAvailable():!1,U=S("webauthn_login_enabled"),ae=async()=>{Y(!g())};let p=null;const F=async n=>{if(!Re()){n||C.error(o("users.webauthn_not_supported"));return}if(n&&!await se())return;p==null||p.abort();const i=new AbortController;p=i;const m=n?"":s();!n&&_()==="true"?localStorage.setItem("username",s()):localStorage.removeItem("username");const P=await re(m,i.signal);Pe(P,async j=>{try{const f=Ae(j.options);f.signal=i.signal,n&&(f.mediation="conditional");const ce=await Oe(f),ue=await oe(j.session,ce,m,i.signal);H(ue,de=>{C.success(o("login.success")),k(de.token),T(decodeURIComponent(B.redirect||I||"/"),!0)})}catch(f){f instanceof Error&&f.name!="AbortError"&&C.error(f.message)}})},N=()=>p==null?void 0:p.abort();_e(()=>{U&&(window.addEventListener("beforeunload",N),F(!0))}),Q(()=>{p==null||p.abort(),window.removeEventListener("beforeunload",N)});const E=async()=>{if(g())await F();else{_()==="true"?(localStorage.setItem("username",s()),localStorage.setItem("password",a())):(localStorage.removeItem("username"),localStorage.removeItem("password"));const n=await ne();H(n,i=>{C.success(o("login.success")),k(i.token),T(decodeURIComponent(B.redirect||I||"/"),!0)},(i,m)=>{!G()&&m===402?ie(!0):C.error(i)})}},[G,ie]=w(!1),K=S("ldap_login_enabled"),le=y("ldap_login_tips");return K&&z(!0),e(Ge,{zIndex:"1",w:"$full",h:"100vh",get children(){return[e(ve,{get bgColor(){return h()},rounded:"$xl",p:"24px",w:{"@initial":"90%","@sm":"364px"},spacing:"$4",get children(){return[e(A,{alignItems:"center",justifyContent:"space-around",get children(){return[e(ye,{mr:"$2",boxSize:"$12",get src(){return xe(()=>!!(r[0]&&r[0].trim()!==""),!0)()?v(r[0],r.pop()):"/images/icon/logo.png"}}),e(Se,{color:"$info9",fontSize:"$xl",get children(){return c()}})]}}),e(b,{get when(){return!G()},get fallback(){return e(O,{id:"totp",name:"otp",get placeholder(){return o("login.otp-tips")},get value(){return t()},onInput:n=>l(n.currentTarget.value),onKeyDown:n=>{n.key==="Enter"&&E()}})},get children(){return[e(O,{name:"username",get placeholder(){return o("login.username-tips")},get value(){return s()},onInput:n=>u(n.currentTarget.value)}),e(b,{get when(){return!g()},get children(){return e(O,{name:"password",get placeholder(){return o("login.password-tips")},type:"password",get value(){return a()},onInput:n=>d(n.currentTarget.value),onKeyDown:n=>{n.key==="Enter"&&E()}})}}),e(A,{px:"$1",w:"$full",fontSize:"$sm",color:"$neutral10",justifyContent:"space-between",alignItems:"center",get children(){return e(q,{get checked(){return _()==="true"},onChange:()=>ee(_()==="true"?"false":"true"),get children(){return o("login.remember")}})}})]}}),e(ke,{w:"$full",spacing:"$2",get children(){return[e(b,{get when(){return!g()},get children(){return e(D,{colorScheme:"primary",w:"$full",onClick:()=>{G()?l(""):(u(""),d(""))},get children(){return o("login.clear")}})}}),e(D,{w:"$full",get loading(){return te()},onClick:E,get children(){return o("login.login")}})]}}),e(b,{when:K,get children(){return e(q,{w:"$full",get checked(){return L()===!0},onChange:()=>z(!L()),children:le})}}),e(A,{mt:"$2",justifyContent:"space-evenly",alignItems:"center",color:"$neutral10",w:"$full",get children(){return[e(Ie,{}),e(Le,{}),e(je,{}),e(b,{when:U,get children(){return e(X,{cursor:"pointer",boxSize:"$8",as:Ee,p:"$0_5",onclick:ae})}})]}})]}}),e(Ke,{})]}})};export{Ve as default};
